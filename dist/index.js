(()=>{var e={793:e=>{const t="https://api.cloudways.com/api/v1";async function getAccessToken(e,o){console.log("[API] Obtaining OAuth access token...");const n=await fetch(`${t}/oauth/access_token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,api_key:o})});const r=await n.json();if(!r.access_token){throw new Error(`Failed to obtain access token: ${JSON.stringify(r)}`)}console.log("✅ [API] Access token obtained");return r.access_token}async function executeVarnishAction(e,o,n){const r=`${t}/service/varnish`;const s=parseInt(o,10);const i={server_id:s,action:n};console.log(`[API] Executing Varnish ${n} on server ${o}...`);const a=await fetch(r,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(i)});const c=await a.json();console.log("[API] Response:",JSON.stringify(c));if(c.status===false){const e=c.message||"Unknown error";throw new Error(`Operation failed: ${e}`)}if(c.status===true){console.log(`✅ [API] Varnish ${n} completed successfully`);return{completed:true}}throw new Error(`Unexpected response: ${JSON.stringify(c)}`)}async function checkOperationStatus(e,o){const n=await fetch(`${t}/operation/${o}`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});return n.json()}function sleep(e){return new Promise((t=>{setTimeout(t,e)}))}async function checkOperationUntilComplete(e,t,o,n,r){if(o>n){console.log("");const e=`Operation timed out after ${n} attempts (ID: ${t})`;throw new Error(e)}await sleep(r);const s=await checkOperationStatus(e,t);if(s.operation){if(s.operation.is_completed){console.log("✅ [API] Operation completed successfully");return s.operation}}process.stdout.write(".");return checkOperationUntilComplete(e,t,o+1,n,r)}async function waitForCompletion(e,t,o,n){const r=o||30;const s=n||5e3;console.log("[API] Waiting for operation to complete...");return checkOperationUntilComplete(e,t,1,r,s)}e.exports={getAccessToken:getAccessToken,executeVarnishAction:executeVarnishAction,checkOperationStatus:checkOperationStatus,waitForCompletion:waitForCompletion}},700:e=>{const t=["enable","disable","purge"];function fromEnv(e,t=""){const o=Object.prototype.hasOwnProperty.call(process.env,e);const n=o?process.env[e]:process.env[`INPUT_${e}`];return n===undefined||n===null||n===""?t:n}function getInputs(){return{email:fromEnv("CLOUDWAYS_EMAIL"),apiKey:fromEnv("CLOUDWAYS_API_KEY"),serverId:fromEnv("CLOUDWAYS_SERVER_ID"),action:fromEnv("ACTION","enable").toLowerCase()}}function assertRequired(e){const o=[];if(!e.email)o.push("CLOUDWAYS_EMAIL");if(!e.apiKey)o.push("CLOUDWAYS_API_KEY");if(!e.serverId)o.push("CLOUDWAYS_SERVER_ID");if(o.length){throw new Error(`Missing required inputs: ${o.join(", ")}`)}if(!t.includes(e.action)){throw new Error(`Invalid ACTION '${e.action}'. Must be one of: ${t.join(", ")}`)}}e.exports={getInputs:getInputs,assertRequired:assertRequired,VALID_ACTIONS:t}}};var t={};function __nccwpck_require__(o){var n=t[o];if(n!==undefined){return n.exports}var r=t[o]={exports:{}};var s=true;try{e[o](r,r.exports,__nccwpck_require__);s=false}finally{if(s)delete t[o]}return r.exports}if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var o={};const{getInputs:n,assertRequired:r}=__nccwpck_require__(700);const{getAccessToken:s,executeVarnishAction:i,waitForCompletion:a}=__nccwpck_require__(793);async function main(){try{const e=n();r(e);console.log(`[Varnish] Action: ${e.action}`);console.log(`[Varnish] Server ID: ${e.serverId}`);const t=await s(e.email,e.apiKey);const o=await i(t,e.serverId,e.action);if(e.waitForCompletion){await a(t,o.id);console.log("✅ [Varnish] Operation completed successfully")}else{console.log(`✅ [Varnish] Operation initiated (ID: ${o.id})`);console.log("   Use the operation ID to check status later")}process.exit(0)}catch(e){console.error("⚠️ [Varnish] Error:",e.message);process.exit(1)}}main();module.exports=o})();